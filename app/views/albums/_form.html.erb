<%= form_with(model: @album, local: true) do |form| %>
  <% if form.object.errors.any? %>
    <div>
      <% form.object.errors.full_messages.each do |message|  %>
        <div class="text-red-500"><%= message %></div>
      <% end %>
    </div>
  <% end %>

  <div class="">
    <!-- Current Cover Art Display -->
    <% if @album.cover_art_url.present? %>
      <div id="<%= dom_id(@album, :cover_art) %>" class="flex flex-col justify-center items-center">
        <%= image_tag @album.cover_art_url, class: "w-1/3 py-2" %>
        <%= link_to "Remove image", destroy_cover_album_path(@album), class: "border border-input-background rounded bg-red-400 py-1 px-2 my-2", data: { turbo_method: :delete, turbo_confirm: "are you sure?" } %>
      </div>
    <% end %>

    <!-- Cover Art Upload -->
    <div class="rounded-sm p-2" data-controller="file-upload">
      <div class="flex items-center my-4">
        <%= label_tag :cover_art_upload, "Select Cover Art" %>&nbsp;
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V8m0 8h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
          <span class="text-sm">w-640 x h-640 - 10MB max</span>
        </svg>
      </div>
      <%= file_field_tag :cover_art_upload,
          class: "block w-full text-sm border rounded-sm cursor-pointer text-zinc-800 focus:outline-none bg-gray-100 border-gray-100",
          accept: "image/jpeg,image/png,image/webp",
          data: {
            target: "#album_cover_art_url",
            action: "change->file-upload#upload"
          } %>
          
      <div class="upload-status" id="image-upload-status"></div>
      
      <%# This hidden field stores the S3 URL %>
      <%= form.hidden_field :cover_art_url %>
    </div>
    
    <!-- Album Details -->
    <div class="border border-gray-100 rounded-sm p-2 mt-1">
      <h2 class="text-xl font-medium text-gray-100 align-middle text-center p-2">Album Details</h2>
      
      <!-- Album Title -->
      <div class="flex justify-between items-center my-2">
        <%= form.label :title, class: "w-52" %>
        <%= form.text_field :title, class: "rounded-sm border border-slate-600 bg-gray-100 text-zinc-800 w-full", placeholder: "Album title" %>
      </div>
      
      <!-- Artist Selection -->
      <div class="flex justify-between items-center my-2">
        <%= form.label :artist_id, "Artist", class: "w-52" %>
        <%= form.collection_select :artist_id, 
            current_user.artists.order(:name), 
            :id, :name, 
            { prompt: "Select artist", selected: (params[:artist_id] || @album.artist_id) }, 
            { class: "rounded-sm border border-slate-600 bg-gray-100 text-zinc-800 w-full" } %>
      </div>
      
      <!-- Genre Selection -->
      <div class="flex justify-between items-center my-2">
        <%= form.label :genre_id, "Genre", class: "w-52" %>
        <%= form.collection_select :genre_id, 
            Genre.all.order(:name), 
            :id, :name, 
            { prompt: "Select genre (optional)" }, 
            { class: "rounded-sm border border-slate-600 bg-gray-100 text-zinc-800 w-full" } %>
      </div>
    </div>
    
    <!-- Form Actions -->
    <div class="flex gap-2 mt-4">
      <%= form.submit (@album.persisted? ? "Update Album" : "Create Album"), class: "border border-gray-100 bg-slate-900 text-gray-100 rounded-sm px-6 py-2" %>
      <%= link_to "Cancel", (@album.persisted? ? album_path(@album) : albums_path), class: "border border-gray-300 bg-gray-200 text-gray-800 rounded-sm px-6 py-2" %>
    </div>
  </div>
<% end %>
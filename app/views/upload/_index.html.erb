<!-- Song Upload Tab Content -->
<div id="song-content" class="tab-content">
  <%= form_with model: @song, url: upload_song_path, local: true, data: { turbo_frame: "upload_frame" } do |form| %>
    
    <!-- Error Messages -->
    <% if @song.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <ul class="list-disc pl-5">
          <% @song.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Song Image Upload -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <div class="flex items-center mb-4">
        <%= form.label :song_image, "Song Cover Image", class: "text-lg font-medium" %>
        <svg class="w-5 h-5 ml-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="text-sm text-gray-400 ml-1">640x640 - 5MB max</span>
      </div>
      <%= form.file_field :song_image, 
          class: "block w-full text-sm border rounded-lg cursor-pointer text-gray-300 focus:outline-none bg-gray-700 border-gray-600 placeholder-gray-400", 
          accept: "image/jpeg,image/png,image/webp" %>
    </div>

    <!-- Song File Upload -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <div class="flex items-center mb-4">
        <%= form.label :song_file, "Audio File", class: "text-lg font-medium text-red-400" %>
        <span class="text-sm text-red-400 ml-2">* Required</span>
        <svg class="w-5 h-5 ml-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="text-sm text-gray-400 ml-1">MP3, WAV, OGG, M4A - 50MB max</span>
      </div>
      <%= form.file_field :song_file, 
          class: "block w-full text-sm border rounded-lg cursor-pointer text-gray-300 focus:outline-none bg-gray-700 border-gray-600 placeholder-gray-400", 
          accept: "audio/mpeg,audio/mp3,audio/wav,audio/ogg,audio/m4a" %>
    </div>

    <!-- Song Details -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <h3 class="text-xl font-medium text-center mb-4">Song Details</h3>
      
      <!-- Song Title -->
      <div class="mb-4">
        <%= form.label :title, "Song Title", class: "block text-sm font-medium mb-2 text-red-400" %>
        <span class="text-sm text-red-400">* Required</span>
        <%= form.text_field :title, 
            class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "Enter song title" %>
      </div>

      <!-- Artist Selection -->
      <div class="mb-4">
        <%= form.label :artist_id, "Artist", class: "block text-sm font-medium mb-2 text-red-400" %>
        <span class="text-sm text-red-400">* Required</span>
        <div class="space-y-2">
          <% if @artists.any? %>
            <%= form.collection_select :artist_id,
                @artists, :id, :name,
                { prompt: "Select existing artist" },
                { class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", id: "artist_select" } %>
          <% else %>
            <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-2">
              <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                <p class="text-sm">
                  <strong>No artists found!</strong> Use the <strong>"Create Artist"</strong> tab above to add an artist first, or create a new one below.
                </p>
              </div>
            </div>
            <select disabled class="w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="artist_select">
              <option>No artists available - create one first</option>
            </select>
          <% end %>
          
          <div class="flex items-center">
            <input type="checkbox" id="create_new_artist" class="rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
            <label for="create_new_artist" class="ml-2 text-sm">Create New Artist</label>
          </div>
        </div>
      </div>

      <!-- Inline Artist Creation Fields -->
      <div id="new_artist_fields" class="hidden bg-gray-700 rounded-lg p-4 mb-4">
        <h4 class="font-medium mb-3">New Artist Details</h4>
        
        <%= form.fields_for :new_artist do |artist_form| %>
          <div class="space-y-3">
            <div>
              <%= artist_form.label :name, "Artist Name", class: "block text-sm font-medium mb-1" %>
              <%= artist_form.text_field :name, 
                  class: "w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
                  placeholder: "Enter artist name" %>
            </div>
            
            <div>
              <%= artist_form.label :bio, "Artist Bio", class: "block text-sm font-medium mb-1" %>
              <%= artist_form.text_area :bio, rows: 3,
                  class: "w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
                  placeholder: "Enter artist biography (optional)" %>
            </div>
            
            <div>
              <%= artist_form.label :artist_image, "Artist Image", class: "block text-sm font-medium mb-1" %>
              <%= artist_form.file_field :artist_image, 
                  class: "block w-full text-sm border rounded-lg cursor-pointer text-gray-300 focus:outline-none bg-gray-600 border-gray-500", 
                  accept: "image/jpeg,image/png,image/webp" %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Album Selection -->
      <div class="mb-4">
        <%= form.label :album_id, "Album", class: "block text-sm font-medium mb-2" %>
        <span class="text-sm text-gray-400">(Optional)</span>
        <div class="space-y-2">
          <% if @albums.any? %>
            <%= form.collection_select :album_id,
                @albums, :id, :title,
                { prompt: "Select existing album (optional)" },
                { class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", id: "album_select" } %>
          <% else %>
            <div class="bg-gray-100 border border-gray-400 text-gray-700 px-4 py-3 rounded mb-2">
              <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                <p class="text-sm">
                  No albums yet. Use the <strong>"Create Album"</strong> tab to add albums, or create one below.
                </p>
              </div>
            </div>
            <select disabled class="w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="album_select">
              <option>No albums available (optional)</option>
            </select>
          <% end %>
          
          <div class="flex items-center">
            <input type="checkbox" id="create_new_album" class="rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
            <label for="create_new_album" class="ml-2 text-sm">Create New Album</label>
          </div>
        </div>
      </div>

      <!-- Inline Album Creation Fields -->
      <div id="new_album_fields" class="hidden bg-gray-700 rounded-lg p-4 mb-4">
        <h4 class="font-medium mb-3">New Album Details</h4>
        
        <%= form.fields_for :new_album do |album_form| %>
          <div class="space-y-3">
            <div>
              <%= album_form.label :title, "Album Title", class: "block text-sm font-medium mb-1" %>
              <%= album_form.text_field :title, 
                  class: "w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
                  placeholder: "Enter album title" %>
            </div>
            
            <div>
              <%= album_form.label :artist_id, "Album Artist", class: "block text-sm font-medium mb-1" %>
              <%= album_form.collection_select :artist_id, 
                  @artists, :id, :name, 
                  { prompt: "Select artist for album" }, 
                  { class: "w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
            </div>
            
            <div>
              <%= album_form.label :genre_id, "Album Genre", class: "block text-sm font-medium mb-1" %>
              <%= album_form.collection_select :genre_id, 
                  @genres, :id, :name, 
                  { prompt: "Select genre (optional)" }, 
                  { class: "w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
            </div>
            
            <div>
              <%= album_form.label :cover_art, "Album Cover", class: "block text-sm font-medium mb-1" %>
              <%= album_form.file_field :cover_art, 
                  class: "block w-full text-sm border rounded-lg cursor-pointer text-gray-300 focus:outline-none bg-gray-600 border-gray-500", 
                  accept: "image/jpeg,image/png,image/webp" %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Genre Selection -->
      <div class="mb-4">
        <%= form.label :genre_ids, "Genres", class: "block text-sm font-medium mb-2" %>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 max-h-40 overflow-y-auto border border-gray-600 rounded-lg p-3 bg-gray-700">
          <% @genres.each do |genre| %>
            <div class="flex items-center">
              <%= form.check_box :genre_ids, 
                  { multiple: true, checked: @song.genre_ids.include?(genre.id), class: "rounded border-gray-500 text-blue-600 focus:ring-blue-500 bg-gray-600" }, 
                  genre.id, "" %>
              <%= form.label "genre_ids_#{genre.id}", genre.name, class: "ml-2 text-sm" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-center">
      <%= form.submit "Upload Song", 
          class: "bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition-colors duration-200 focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50" %>
    </div>
  <% end %>
</div>

<!-- Artist Creation Tab Content -->
<div id="artist-content" class="tab-content hidden">
  <%= form_with model: @artist, url: upload_artist_path, local: true, data: { turbo_frame: "upload_frame" } do |form| %>
    
    <!-- Error Messages -->
    <% if @artist.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <ul class="list-disc pl-5">
          <% @artist.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Artist Image Upload -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <div class="flex items-center mb-4">
        <%= form.label :artist_image, "Artist Image", class: "text-lg font-medium" %>
        <svg class="w-5 h-5 ml-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="text-sm text-gray-400 ml-1">640x640 - 5MB max</span>
      </div>
      <%= form.file_field :artist_image, 
          class: "block w-full text-sm border rounded-lg cursor-pointer text-gray-300 focus:outline-none bg-gray-700 border-gray-600 placeholder-gray-400", 
          accept: "image/jpeg,image/png,image/webp" %>
    </div>

    <!-- Artist Details -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <h3 class="text-xl font-medium text-center mb-4">Artist Details</h3>
      
      <!-- Artist Name -->
      <div class="mb-4">
        <%= form.label :name, "Artist Name", class: "block text-sm font-medium mb-2 text-red-400" %>
        <span class="text-sm text-red-400">* Required</span>
        <%= form.text_field :name, 
            class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "Enter artist name" %>
      </div>
      
      <!-- Artist Bio -->
      <div class="mb-4">
        <%= form.label :bio, "Artist Biography", class: "block text-sm font-medium mb-2" %>
        <%= form.text_area :bio, rows: 4,
            class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "Tell us about the artist (optional)" %>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-center">
      <%= form.submit "Create Artist", 
          class: "bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-8 rounded-lg transition-colors duration-200 focus:ring-4 focus:ring-green-500 focus:ring-opacity-50" %>
    </div>
  <% end %>
</div>

<!-- Album Creation Tab Content -->
<div id="album-content" class="tab-content hidden">
  <%= form_with model: @album, url: upload_album_path, local: true, data: { turbo_frame: "upload_frame" } do |form| %>
    
    <!-- Error Messages -->
    <% if @album.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <ul class="list-disc pl-5">
          <% @album.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Cover Art Upload -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <div class="flex items-center mb-4">
        <%= form.label :cover_art, "Album Cover Art", class: "text-lg font-medium" %>
        <svg class="w-5 h-5 ml-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="text-sm text-gray-400 ml-1">640x640 - 10MB max</span>
      </div>
      <%= form.file_field :cover_art, 
          class: "block w-full text-sm border rounded-lg cursor-pointer text-gray-300 focus:outline-none bg-gray-700 border-gray-600 placeholder-gray-400", 
          accept: "image/jpeg,image/png,image/webp" %>
    </div>

    <!-- Album Details -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <h3 class="text-xl font-medium text-center mb-4">Album Details</h3>
      
      <!-- Album Title -->
      <div class="mb-4">
        <%= form.label :title, "Album Title", class: "block text-sm font-medium mb-2 text-red-400" %>
        <span class="text-sm text-red-400">* Required</span>
        <%= form.text_field :title, 
            class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "Enter album title" %>
      </div>
      
      <!-- Artist Selection -->
      <div class="mb-4">
        <%= form.label :artist_id, "Artist", class: "block text-sm font-medium mb-2 text-red-400" %>
        <span class="text-sm text-red-400">* Required</span>
        <div class="space-y-2">
          <% if @artists.any? %>
            <%= form.collection_select :artist_id,
                @artists, :id, :name,
                { prompt: "Select artist" },
                { class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500", id: "album_artist_select" } %>
          <% else %>
            <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-2">
              <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                <p class="text-sm">
                  <strong>No artists found!</strong> Use the <strong>"Create Artist"</strong> tab first to add an artist.
                </p>
              </div>
            </div>
            <select disabled class="w-full rounded-lg border bg-gray-600 border-gray-500 text-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="album_artist_select">
              <option>No artists available - create one first</option>
            </select>
          <% end %>
          
          <div class="flex items-center">
            <input type="checkbox" id="create_album_artist" class="rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
            <label for="create_album_artist" class="ml-2 text-sm">Create New Artist</label>
          </div>
        </div>
      </div>

      <!-- Inline Artist Creation for Albums -->
      <div id="album_artist_fields" class="hidden bg-gray-700 rounded-lg p-4 mb-4">
        <h4 class="font-medium mb-3">New Artist Details</h4>
        
        <!-- Note: This would need to be handled differently since we can't nest forms -->
        <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4">
          <p class="text-sm">To create a new artist for this album, please use the "Create Artist" tab first, then return to create your album.</p>
        </div>
      </div>
      
      <!-- Genre Selection -->
      <div class="mb-4">
        <%= form.label :genre_id, "Album Genre", class: "block text-sm font-medium mb-2" %>
        <%= form.collection_select :genre_id, 
            @genres, :id, :name, 
            { prompt: "Select genre (optional)" }, 
            { class: "w-full rounded-lg border bg-gray-700 border-gray-600 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-center">
      <%= form.submit "Create Album", 
          class: "bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-8 rounded-lg transition-colors duration-200 focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50" %>
    </div>
  <% end %>
</div>